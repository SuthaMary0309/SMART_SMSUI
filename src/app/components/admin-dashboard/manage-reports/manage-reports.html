<div class="report-container">
  <!-- Header -->
  <div class="report-header">
    <h2><i class="bi bi-file-earmark-bar-graph"></i> {{ t.title }}</h2>
    <div class="lang-selector">
      <button [class.active]="currentLang === 'en'" (click)="changeLang('en')">English</button>
      <button [class.active]="currentLang === 'ta'" (click)="changeLang('ta')">தமிழ்</button>
      <button [class.active]="currentLang === 'si'" (click)="changeLang('si')">සිංහල</button>
    </div>
  </div>

  <!-- Controls -->
  <div class="controls-section">
    <div class="control-group">
      <label>Select Student</label>
      <select [(ngModel)]="selectedStudentId">
        <option value="">-- Select Student --</option>
        <option *ngFor="let s of students" [value]="s.studentID || s.studentId">
          {{ s.studentName || 'Unknown' }}
        </option>
      </select>
    </div>
    <div class="btn-group">
      <button class="btn-primary" (click)="loadStudentReport()" [disabled]="isLoading">
        <i class="bi bi-search"></i> {{ isLoading ? 'Loading...' : 'Load Report' }}
      </button>
      <button class="btn-success" (click)="exportPDF()" [disabled]="!studentReport">
        <i class="bi bi-file-pdf"></i> Export PDF
      </button>
      <button class="btn-info" (click)="sendEmail()" [disabled]="!studentReport || isSending">
        <i class="bi bi-envelope"></i> {{ isSending ? 'Sending...' : 'Send Email' }}
      </button>
    </div>
  </div>

  <!-- Report Content -->
  <div class="report-content" *ngIf="studentReport">
    <!-- Student Info Card -->
    <div class="info-card">
      <div class="info-avatar">{{ studentReport.studentName?.charAt(0) || 'S' }}</div>
      <div class="info-details">
        <h3>{{ studentReport.studentName || t.noData }}</h3>
        <p><i class="bi bi-building"></i> {{ t.class }}: {{ studentReport.className || t.noData }}</p>
        <p><i class="bi bi-envelope"></i> {{ studentReport.email || t.noData }}</p>
        <p><i class="bi bi-telephone"></i> {{ studentReport.phone || t.noData }}</p>
      </div>
    </div>

    <!-- Stats Summary -->
    <div class="stats-row">
      <div class="stat-box highest">
        <h4>{{ studentReport.highest ?? t.noData }}</h4>
        <p>{{ t.highest }}</p>
      </div>
      <div class="stat-box lowest">
        <h4>{{ studentReport.lowest ?? t.noData }}</h4>
        <p>{{ t.lowest }}</p>
      </div>
      <div class="stat-box average">
        <h4>{{ studentReport.average ? (studentReport.average | number:'1.0-0') : t.noData }}</h4>
        <p>{{ t.average }}</p>
      </div>
    </div>

    <!-- Chart -->
    <div class="chart-section">
      <h4><i class="bi bi-bar-chart"></i> Performance Chart</h4>
      <div class="chart-wrapper">
        <canvas #reportChart></canvas>
      </div>
    </div>

    <!-- Marks Table -->
    <div class="table-section">
      <h4><i class="bi bi-table"></i> {{ t.marks }} Details</h4>
      <table>
        <thead>
          <tr>
            <th>Subject / Exam</th>
            <th>{{ t.marks }}</th>
            <th>{{ t.grade }}</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let m of studentReport.marks">
            <td>{{ m.subjectName || m.examName || t.noData }}</td>
            <td>{{ m.mark ?? t.noData }}</td>
            <td><span class="grade-badge" [class]="'grade-' + getGrade(m.mark)">{{ getGrade(m.mark) }}</span></td>
          </tr>
          <tr *ngIf="!studentReport.marks || studentReport.marks.length === 0">
            <td colspan="3" class="no-data">{{ t.noData }}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- No Data State -->
  <div class="empty-state" *ngIf="!studentReport && !isLoading">
    <i class="bi bi-clipboard-data"></i>
    <p>Select a student and click "Load Report" to view details</p>
  </div>

  <!-- Loading State -->
  <div class="loading-state" *ngIf="isLoading">
    <div class="spinner"></div>
    <p>Loading report...</p>
  </div>
</div>
